(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7d8fe7f6"],{"5a2c":function(t,e,s){"use strict";s("a238")},6062:function(t,e,s){"use strict";var i=s("6d61"),n=s("6566");t.exports=i("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),n)},6566:function(t,e,s){"use strict";var i=s("9bf2").f,n=s("7c73"),r=s("e2cc"),a=s("0366"),o=s("19aa"),c=s("2266"),u=s("7dd0"),l=s("2626"),d=s("83ab"),f=s("f183").fastKey,v=s("69f3"),m=v.set,h=v.getterFor;t.exports={getConstructor:function(t,e,s,u){var l=t((function(t,i){o(t,l,e),m(t,{type:e,index:n(null),first:void 0,last:void 0,size:0}),d||(t.size=0),void 0!=i&&c(i,t[u],{that:t,AS_ENTRIES:s})})),v=h(e),p=function(t,e,s){var i,n,r=v(t),a=g(t,e);return a?a.value=s:(r.last=a={index:n=f(e,!0),key:e,value:s,previous:i=r.last,next:void 0,removed:!1},r.first||(r.first=a),i&&(i.next=a),d?r.size++:t.size++,"F"!==n&&(r.index[n]=a)),t},g=function(t,e){var s,i=v(t),n=f(e);if("F"!==n)return i.index[n];for(s=i.first;s;s=s.next)if(s.key==e)return s};return r(l.prototype,{clear:function(){var t=this,e=v(t),s=e.index,i=e.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete s[i.index],i=i.next;e.first=e.last=void 0,d?e.size=0:t.size=0},delete:function(t){var e=this,s=v(e),i=g(e,t);if(i){var n=i.next,r=i.previous;delete s.index[i.index],i.removed=!0,r&&(r.next=n),n&&(n.previous=r),s.first==i&&(s.first=n),s.last==i&&(s.last=r),d?s.size--:e.size--}return!!i},forEach:function(t){var e,s=v(this),i=a(t,arguments.length>1?arguments[1]:void 0,3);while(e=e?e.next:s.first){i(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!g(this,t)}}),r(l.prototype,s?{get:function(t){var e=g(this,t);return e&&e.value},set:function(t,e){return p(this,0===t?0:t,e)}}:{add:function(t){return p(this,t=0===t?0:t,t)}}),d&&i(l.prototype,"size",{get:function(){return v(this).size}}),l},setStrong:function(t,e,s){var i=e+" Iterator",n=h(e),r=h(i);u(t,e,(function(t,e){m(this,{type:i,target:t,state:n(t),kind:e,last:void 0})}),(function(){var t=r(this),e=t.kind,s=t.last;while(s&&s.removed)s=s.previous;return t.target&&(t.last=s=s?s.next:t.state.first)?"keys"==e?{value:s.key,done:!1}:"values"==e?{value:s.value,done:!1}:{value:[s.key,s.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),s?"entries":"values",!s,!0),l(e)}}},"6d1a":function(t,e,s){t.exports=s.p+"img/icon_send.2d406717.svg"},"6d61":function(t,e,s){"use strict";var i=s("23e7"),n=s("da84"),r=s("94ca"),a=s("6eeb"),o=s("f183"),c=s("2266"),u=s("19aa"),l=s("861d"),d=s("d039"),f=s("1c7e"),v=s("d44e"),m=s("7156");t.exports=function(t,e,s){var h=-1!==t.indexOf("Map"),p=-1!==t.indexOf("Weak"),g=h?"set":"add",b=n[t],_=b&&b.prototype,x=b,C={},w=function(t){var e=_[t];a(_,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(p&&!l(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return p&&!l(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(p&&!l(t))&&e.call(this,0===t?0:t)}:function(t,s){return e.call(this,0===t?0:t,s),this})},y=r(t,"function"!=typeof b||!(p||_.forEach&&!d((function(){(new b).entries().next()}))));if(y)x=s.getConstructor(e,t,h,g),o.REQUIRED=!0;else if(r(t,!0)){var k=new x,M=k[g](p?{}:-0,1)!=k,U=d((function(){k.has(1)})),O=f((function(t){new b(t)})),L=!p&&d((function(){var t=new b,e=5;while(e--)t[g](e,e);return!t.has(-0)}));O||(x=e((function(e,s){u(e,x,t);var i=m(new b,e,x);return void 0!=s&&c(s,i[g],{that:i,AS_ENTRIES:h}),i})),x.prototype=_,_.constructor=x),(U||L)&&(w("delete"),w("has"),h&&w("get")),(L||M)&&w(g),p&&_.clear&&delete _.clear}return C[t]=x,i({global:!0,forced:x!=b},C),v(x,t),p||s.setStrong(x,t,h),x}},7767:function(t,e,s){},"9a3b":function(t,e,s){},a238:function(t,e,s){},a2c8:function(t,e,s){"use strict";s("7767")},b936:function(t,e,s){"use strict";s("9a3b")},bb2f:function(t,e,s){var i=s("d039");t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},f183:function(t,e,s){var i=s("d012"),n=s("861d"),r=s("5135"),a=s("9bf2").f,o=s("90e3"),c=s("bb2f"),u=o("meta"),l=0,d=Object.isExtensible||function(){return!0},f=function(t){a(t,u,{value:{objectID:"O"+l++,weakData:{}}})},v=function(t,e){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,u)){if(!d(t))return"F";if(!e)return"E";f(t)}return t[u].objectID},m=function(t,e){if(!r(t,u)){if(!d(t))return!0;if(!e)return!1;f(t)}return t[u].weakData},h=function(t){return c&&p.REQUIRED&&d(t)&&!r(t,u)&&f(t),t},p=t.exports={REQUIRED:!1,fastKey:v,getWeakData:m,onFreeze:h};i[u]=!0},ffce:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container PublicMessage"},[s("Sidebar"),s("div",{staticClass:"publicMessage-wrap"},[s("section",{staticClass:"publicUsers"},[s("div",{staticClass:"publicUsers-wrap"},[s("h2",{staticClass:"headbar"},[s("div",{staticClass:"title"},[s("div",{staticClass:"main-title"},[t._v("上線使用者 ("+t._s(t.onlineUsersNum)+")")])])]),s("div",{staticClass:"publicUsers-list"},[t.isLoading?s("Spinner"):t._l(t.onlineUsers,(function(t){return s("OnlineUsers",{key:t.id,attrs:{user:t}})}))],2)])]),s("section",{staticClass:"publicChatroom"},[s("div",{staticClass:"publicChatroom-wrap"},[t._m(0),s("div",{staticClass:"publicChatroomCard"},[s("PublicChatroom")],1)])])])],1)},n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h2",{staticClass:"headbar"},[s("div",{staticClass:"title"},[s("div",{staticClass:"main-title"},[t._v("公開聊天室")])])])}],r=s("5530"),a=(s("d3b7"),s("6062"),s("3ca3"),s("ddb0"),s("4de4"),s("2f62")),o=s("2708"),c=s("5ea5"),u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",{staticClass:"notice"},[s("router-link",{staticClass:"avatar",attrs:{to:"/users/"+t.user.id}},[s("img",{attrs:{src:t._f("emptyImage")(t.user.avatar),alt:""}})]),s("div",{staticClass:"notice-info"},[s("div",{staticClass:"user-info"},[s("router-link",{staticClass:"name",attrs:{to:"/users/"+t.user.id}},[t._v(" "+t._s(t.user.name)+" ")]),s("span",{staticClass:"account"},[t._v("@"+t._s(t.user.account))])],1),t.user.msg?s("div",{staticClass:"user-msg"},[s("span",{staticClass:"last-msg"},[t._v(t._s(t.user.msg))]),s("span",{staticClass:"last-time"},[t._v(t._s(t._f("fromNow")(t.user.createdAt)))])]):t._e()]),t.user.msg?s("div",{staticClass:"full-link",on:{click:function(e){return t.userActive(t.user)}}}):t._e()],1)},l=[],d=(s("b0c0"),{name:"OnelineUsers",mixins:[o["c"],o["a"]],props:{user:{type:Object,required:!0}},computed:Object(r["a"])({},Object(a["b"])(["currentUser"])),methods:{userActive:function(t){console.log("切換到使用者：".concat(t.name," 的訊息聊天室"))}}}),f=d,v=(s("a2c8"),s("2877")),m=Object(v["a"])(f,u,l,!1,null,"02c14b1d",null),h=m.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"messages",staticClass:"chat-wrap",class:{"show-load-more":t.showLoadMore},on:{scroll:function(e){return t.handleScroll(e)}}},[t.isLoading?i("Spinner"):i("div",{staticClass:"chat messages",attrs:{id:"messages"}},["limited"===t.loadMoreLimit?i("div",{staticClass:"load-text load-limited"},[t._v(" 沒有更多訊息了！ ")]):t._e(),t.showLoadMore?i("div",{staticClass:"load-text load-more"},[i("span",{staticClass:"loading"}),i("span",[t._v("正在載入訊息...")])]):t._e(),t._l(t.messages,(function(e){return i("div",{key:e.id},[e.isSelf?i("div",{staticClass:"self msg"},[i("p",[t._v(" "+t._s(e.content)+" ")]),i("span",[t._v(t._s(t._f("fromNow")(e.createdAt)))])]):i("div",{staticClass:"other msg"},[i("router-link",{staticClass:"avatar",attrs:{to:"/users/"+e.UserId}},[i("img",{attrs:{src:t._f("emptyImage")(e.avatar),alt:""}})]),i("div",{},[i("p",[t._v(" "+t._s(e.content)+" ")]),i("span",[t._v(t._s(t._f("fromNow")(e.createdAt)))])])],1)])}))],2),i("div",{staticClass:"d-flex justify-content-center divgn-items-center send-wrap"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],attrs:{placeholder:"請輸入訊息 ...",type:"text",maxlength:"160"},domProps:{value:t.text},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.postPublicMsg.apply(null,arguments)},input:function(e){e.target.composing||(t.text=e.target.value)}}}),i("button",{staticClass:"send-btn",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.postPublicMsg.apply(null,arguments)}}},[i("img",{attrs:{src:s("6d1a"),alt:""}})])])],1)},g=[],b=s("2909"),_=(s("d81d"),s("2fa3")),x=s("2375"),C={mixins:[o["c"],o["a"]],components:{Spinner:x["a"]},data:function(){return{socket:null,text:"",memberNum:0,messages:{avatar:"",content:"",createdAt:""},loadMoreLimit:20,showLoadMore:!1,isLoading:!0}},computed:Object(r["a"])({},Object(a["b"])(["currentUser"])),created:function(){var t=this.currentUser.id;this.joinPublicRoom(t),this.getPublicHistory(20)},updated:function(){20===this.loadMoreLimit&&this.updateScroll(this.$refs.messages.scrollHeight)},watch:{isPostMsg:function(t){var e=this;t&&setTimeout((function(){e.text=""}),500)},text:function(t){""===t&&this.isPostMsg&&(this.updateScroll(this.$refs.messages.scrollHeight),this.isPostMsg=!1)},loadMoreLimit:function(t){var e=this;"limited"===t&&setTimeout((function(){e.loadMoreLimit="nomore"}),3e3)},showLoadMore:function(t){var e=this;t&&setTimeout((function(){e.showLoadMore=!1}),2500)}},sockets:{new_join:function(t){var e=t.name;this.postOnlineInform(e)},online_users:function(t){this.memberNum=t.users.length},get_public_msg:function(t){this.messages.push(t)},user_leave:function(t){var e=t.name;this.postOfflineInform(e)}},methods:{joinPublicRoom:function(t){this.$socket.emit("join_public_room",{userId:t})},getPublicHistory:function(t){var e=this;this.$socket.emit("get_public_history",{offset:0,limit:t},(function(t){e.messages=Object(b["a"])(t.reverse()),e.messages=e.messages.map((function(t){var s=t.UserId,i=t.avatar,n=t.content,r=t.createdAt,a=s===e.currentUser.id;return{UserId:s,avatar:i,content:n,createdAt:r,isSelf:a}})),e.isLoading=!1}))},postPublicMsg:function(){if(this.text.length){this.$socket.emit("post_public_msg",{content:this.text,userId:this.currentUser.id});var t=this.currentUser.avatar,e=this.text,s=new Date,i={avatar:t,content:e,createdAt:s,isSelf:!0};this.messages.push(i),this.text="",_["a"].fire({icon:"success",title:"訊息發送成功"})}else _["a"].fire({icon:"warning",title:"你還沒有填寫訊息"})},postOnlineInform:function(t){_["a"].fire({icon:"info",title:"".concat(t," 加入聊天室")})},postOfflineInform:function(t){_["a"].fire({icon:"info",title:"".concat(t," 離開聊天室")})},leavePublicRoom:function(t){this.$socket.emit("leave_public_room",{userId:t})},updateScroll:function(t){this.$refs.messages.scrollTop=t},handleScroll:function(t){0===t.srcElement.scrollTop&&this.loadMore(),"nomore"===this.loadMoreLimit&&(this.loadMoreLimit="limited")},loadMore:function(){var t=this;if(this.messages.length>=this.loadMoreLimit){this.showLoadMore=!0;var e=this.messages.length+5;setTimeout((function(){t.getPublicHistory(e),t.loadMoreLimit=e}),2e3)}else this.loadMoreLimit-this.messages.length<=5&&(this.loadMoreLimit="limited")}},beforeDestroy:function(){this.leavePublicRoom(this.currentUser.id)}},w=C,y=(s("5a2c"),Object(v["a"])(w,p,g,!1,null,"683c6f6d",null)),k=y.exports,M={mixins:[o["a"]],components:{Sidebar:c["a"],OnlineUsers:h,PublicChatroom:k,Spinner:x["a"]},data:function(){return{onlineUsers:[],socket:null,onlineUsersNum:0,isLoading:!0}},computed:Object(r["a"])({},Object(a["b"])(["currentUser"])),sockets:{online_users:function(t){this.fetchOnlineUsers(t.users),this.onlineUsersNum=t.users.length,this.isLoading=!1}},methods:{fetchOnlineUsers:function(t){var e=new Set,s=t.filter((function(t){return!e.has(t.id)&&e.add(t.id)}));this.onlineUsers=s}}},U=M,O=(s("b936"),Object(v["a"])(U,i,n,!1,null,"3c87379a",null));e["default"]=O.exports}}]);
//# sourceMappingURL=chunk-7d8fe7f6.1580c3b9.js.map
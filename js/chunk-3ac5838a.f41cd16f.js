(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ac5838a"],{"1e32":function(t,e,a){"use strict";a("5e89")},"2f8b":function(t,e,a){"use strict";a("ae76")},"46f7":function(t,e,a){},"5e89":function(t,e,a){},"6f1a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("Sidebar"),s("section",{staticClass:"tweet"},[s("div",{staticClass:"tweet-wrap"},[s("h2",{staticClass:"headbar"},[s("button",{staticClass:"back",on:{click:function(e){return t.$router.back()}}},[s("img",{attrs:{src:a("8480"),alt:""}})]),t._m(0)]),t.isLoading?s("Spinner"):[s("TweetDetail",{attrs:{tweetId:t.tweet.id,initialTweet:t.tweet},on:{"after-create-comment":t.afterCreateComment}}),s("TweetRepliedList",{attrs:{tweet:t.tweet,tweetReplies:t.tweetReplies}})]],2)]),s("UsersTop")],1)},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("div",{staticClass:"main-title"},[t._v("推文")])])}],i=a("2909"),n=a("1da1"),c=a("5530"),o=(a("96cf"),a("a4d3"),a("e01a"),a("b0c0"),a("2f62")),l=a("5ea5"),u=a("3e72"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tweet-detail"},[s("div",{staticClass:"user"},[s("router-link",{staticClass:"avatar",attrs:{to:{name:"user",params:{id:t.tweet.Author.id}}}},[s("img",{attrs:{src:t._f("emptyImage")(t.tweet.Author.avatar),alt:""}})]),s("div",{staticClass:"info"},[s("router-link",{staticClass:"name",attrs:{to:{name:"user",params:{id:t.tweet.Author.id}}}},[t._v(" "+t._s(t.tweet.Author.name)+" ")]),s("span",{staticClass:"account"},[t._v("@"+t._s(t.tweet.Author.account))])],1)],1),s("div",{staticClass:"tweet-content"},[t._v(" "+t._s(t.tweet.description)+" ")]),s("div",{staticClass:"tweet-created-at"},[t._v(" "+t._s(t._f("exactDate")(t.tweet.createdAt))+" ")]),s("div",{staticClass:"tweet-response"},[s("div",{staticClass:"tweet-replies"},[t._v(t._s(t.tweet.replyNum)+" 回覆")]),s("div",{staticClass:"tweet-likes"},[t._v(t._s(t.tweet.likeNum)+" 喜歡次數")])]),s("div",{staticClass:"tweet-response-action"},[t._m(0),s("div",{staticClass:"modal fade",attrs:{id:"replyTweetModal",tabindex:"-1","aria-labelledby":"replyTweetModalLabel","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[t._m(1),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"tweet"},[s("a",{staticClass:"avatar",attrs:{href:""}},[s("img",{attrs:{src:t._f("emptyImage")(t.tweet.Author.avatar),alt:""}})]),s("div",{staticClass:"tweet-info"},[s("div",{staticClass:"user-info"},[s("a",{staticClass:"name",attrs:{href:""}},[t._v(t._s(t.tweet.Author.name))]),s("span",{staticClass:"account"},[t._v("@"+t._s(t.tweet.Author.account))]),s("span",{staticClass:"tweet-update-at"},[t._v(" ・"+t._s(t._f("exactDate")(t.tweet.createdAt))+" ")])]),s("div",{staticClass:"tweet-content"},[t._v(" "+t._s(t.tweet.description)+" ")]),s("div",{staticClass:"tweet-reply-to"},[t._v("回覆給"),s("span",[t._v("@"+t._s(t.tweet.Author.account))])])])]),s("form",{staticClass:"reply-tweet",on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[s("div",{staticClass:"reply-tweet-wrap"},[s("span",{staticClass:"avatar",attrs:{href:""}},[s("img",{attrs:{src:t.currentUser.avatar,alt:""}})]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"reply-textarea",attrs:{name:"comment",id:"",cols:"30",rows:"5",maxlength:"140",placeholder:"推你的回覆"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}})]),s("button",{staticClass:"btn reply-button",attrs:{type:"submit",disabled:t.isProcessing}},[t._v(" "+t._s(t.isProcessing?"回覆中...":"回覆")+" ")])])])])])]),t.tweet.isLike?s("button",{staticClass:"likes",class:{"is-like":t.tweet.isLike},attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteLike(t.tweet.id)}}},[s("img",{attrs:{src:a("bea5"),alt:""}})]):s("button",{staticClass:"likes",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addLike(t.tweet.id)}}},[s("img",{attrs:{src:a("ce3b"),alt:""}})])])])},m=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"tweet-reply-action",attrs:{type:"button","data-toggle":"modal","data-target":"#replyTweetModal"}},[s("img",{attrs:{src:a("2765"),alt:""}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal-header"},[s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("img",{attrs:{src:a("8459"),alt:""}})])])}],p=(a("a9e3"),a("498a"),a("2708")),w=a("6783"),f=a("2fa3"),v=a("1157"),h=a.n(v),b={mixins:[p["b"],p["a"]],props:{initialTweet:{type:Object,required:!0},tweetId:{type:Number,required:!0}},data:function(){return{tweet:this.initialTweet,comment:"",isProcessing:!1}},computed:Object(c["a"])({},Object(o["b"])(["currentUser"])),watch:{initialTweet:function(t){this.tweet=Object(c["a"])(Object(c["a"])({},this.tweet),t)}},methods:{addLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e.isProcessing=!0,a.next=4,w["a"].addLike({tweetId:t});case 4:if(s=a.sent,r=s.data,"success"===r.status){a.next=8;break}throw new Error(r.message);case 8:e.tweet.isLike=!0,e.tweet.likeNum=e.tweet.likeNum+1,e.currentUser.id!==e.tweet.Author.id&&e.postTimeline(e.tweet.Author.id,3,r.Like.id),f["a"].fire({icon:"success",title:"加入喜歡！"}),e.isProcessing=!1,a.next=20;break;case 15:a.prev=15,a.t0=a["catch"](0),console.log(a.t0),f["a"].fire({icon:"error",title:"無法加入喜歡，請稍後再試"}),e.isProcessing=!1;case 20:case"end":return a.stop()}}),a,null,[[0,15]])})))()},deleteLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e.isProcessing=!0,a.next=4,w["a"].deleteLike({tweetId:t});case 4:if(s=a.sent,r=s.data,"success"===r.status){a.next=8;break}throw new Error(r.message);case 8:e.tweet.isLike=!1,e.tweet.likeNum=e.tweet.likeNum-1,f["a"].fire({icon:"success",title:"收回喜歡！"}),e.isProcessing=!1,a.next=19;break;case 14:a.prev=14,a.t0=a["catch"](0),console.log(a.t0),f["a"].fire({icon:"error",title:"無法收回喜歡，請稍後再試"}),e.isProcessing=!1;case 19:case"end":return a.stop()}}),a,null,[[0,14]])})))()},handleSubmit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.comment.trim()){e.next=4;break}return f["a"].fire({icon:"warning",title:"您的推文未填寫任何內容"}),e.abrupt("return");case 4:return t.isProcessing=!0,e.next=7,w["a"].createTweetReply({tweetId:t.tweetId,comment:t.comment});case 7:if(a=e.sent,s=a.data,"error"!==s.status){e.next=11;break}throw new Error(s.message);case 11:t.$emit("after-create-comment",{commentId:t.tweetId,comment:t.comment}),h()("#replyTweetModal").modal("hide"),t.tweet.replyNum+=1,t.currentUser.id!==t.tweet.Author.id&&t.postTimeline(t.tweet.Author.id,2,s.Reply.id),f["a"].fire({icon:"success",title:"回覆推文成功"}),t.isProcessing=!1,t.comment="",e.next=25;break;case 20:e.prev=20,e.t0=e["catch"](0),console.log(e.t0),t.isProcessing=!1,f["a"].fire({icon:"warning",title:"無法新增推文，請稍候在試"});case 25:case"end":return e.stop()}}),e,null,[[0,20]])})))()},postTimeline:function(t,e,a){this.$socket.emit("post_timeline",{ReceiverId:t,type:e,PostId:a})}}},g=b,_=(a("1e32"),a("2877")),C=Object(_["a"])(g,d,m,!1,null,"4768fe7b",null),k=C.exports,y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"tweet-replied-list"},t._l(t.tweetReplies,(function(e){return a("li",{key:e.id,staticClass:"tweet-replied"},[a("router-link",{staticClass:"avatar",attrs:{to:{name:"user",params:{id:e.User.id}}}},[a("img",{attrs:{src:t._f("emptyImage")(e.User.avatar),alt:""}})]),a("div",{staticClass:"tweet-replied-detail"},[a("div",{staticClass:"tweet-replied-user-info"},[a("router-link",{staticClass:"name",attrs:{to:{name:"user",params:{id:e.User.id}}}},[t._v(t._s(e.User.name))]),a("span",{staticClass:"account"},[t._v("@"+t._s(e.User.account))]),a("span",{staticClass:"tweet-update-at"},[t._v("・"+t._s(t._f("fromNow")(e.createdAt)))])],1),a("div",{staticClass:"tweet-replied-to"},[t._v(" 回覆 @"+t._s(t.tweet.Author.account)+" ")]),a("div",{staticClass:"tweet-replied-content"},[t._v(" "+t._s(e.comment)+" ")])])],1)})),0)},x=[],R={mixins:[p["c"],p["a"]],props:{tweet:{type:Object,required:!0},tweetReplies:{type:Array,required:!0}}},T=R,A=(a("2f8b"),Object(_["a"])(T,y,x,!1,null,"6fdb8d28",null)),L=A.exports,P=a("2375"),U={name:"tweet",components:{Sidebar:l["a"],UsersTop:u["a"],TweetDetail:k,TweetRepliedList:L,Spinner:P["a"]},data:function(){return{tweet:{id:-1,description:"",likeNum:3,replyNum:5,isLike:!0,createdAt:"",Author:{}},tweetReplies:[],isLoading:!0}},computed:Object(c["a"])({},Object(o["b"])(["currentUser"])),created:function(){var t=this.$route.params.id;this.fetchTweet(t),this.fetchTweetReplies(t)},beforeRouteUpdate:function(t,e,a){var s=t.params.id;this.fetchTweet(s),this.fetchTweetReplies(s),a()},methods:{fetchTweet:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r,i,n,c,o,l,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,w["a"].getTweet({tweetId:t});case 3:s=a.sent,r=s.data,i=r.id,n=r.description,c=r.likeNum,o=r.replyNum,l=r.isLike,u=r.createdAt,d=r.Author,e.tweet={id:i,description:n,likeNum:c,replyNum:o,isLike:l,createdAt:u,Author:d},a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.log(a.t0),f["a"].fire({icon:"error",title:"無法取得推文資料，請稍後再試"});case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()},fetchTweetReplies:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,w["a"].getTweetReplies({tweetId:t});case 3:s=a.sent,r=s.data,e.tweetReplies=Object(i["a"])(r),e.isLoading=!1,a.next=14;break;case 9:a.prev=9,a.t0=a["catch"](0),e.isLoading=!1,console.log("error",a.t0),f["a"].fire({icon:"error",title:"無法取得推文回覆資料，請稍後再試"});case 14:case"end":return a.stop()}}),a,null,[[0,9]])})))()},afterCreateComment:function(t){var e=t.commentId,a=t.comment;this.tweetReplies.push({id:e,comment:a,createdAt:new Date,User:{id:this.currentUser.id,account:this.currentUser.account,name:this.currentUser.name,avatar:this.currentUser.avatar}})}}},j=U,O=(a("6fc7"),Object(_["a"])(j,s,r,!1,null,"5995df74",null));e["default"]=O.exports},"6fc7":function(t,e,a){"use strict";a("46f7")},8480:function(t,e,a){t.exports=a.p+"img/icon_back.59e5a2e5.svg"},ae76:function(t,e,a){}}]);
//# sourceMappingURL=chunk-3ac5838a.f41cd16f.js.map